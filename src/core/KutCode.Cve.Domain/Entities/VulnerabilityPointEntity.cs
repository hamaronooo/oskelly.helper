using System.ComponentModel.DataAnnotations.Schema;
using KutCode.Cve.Domain.Entities.Base;
using KutCode.Cve.Domain.Models;

namespace KutCode.Cve.Domain.Entities;

/// <summary>
/// Point of CVE activity in computer system - is a combination of software and platform.
/// In some cases one of them (soft or platform) may be not presented.
/// </summary>
[Table("vulnerability_point")]
public sealed class VulnerabilityPointEntity : ModelWithId<Guid>
{
	public VulnerabilityPointEntity() { }
	public VulnerabilityPointEntity(Guid uid, Guid? softId, Guid? platformId) : base(uid)
	{
		if (softId is null && platformId is null)
			throw new ArgumentException("Either platform or software must be presented");
		SoftwareId = softId;
		PlatformId = platformId;
	}
	
	[Column("platform_id")]
	public Guid? PlatformId { get; set; }
	/// <summary>
	/// PlatformEntity where this CVE is active
	/// </summary>
	public PlatformEntity? Platform { get; init; }
	[Column("platform_version")]
	public string? PlatformVersion { get; set; }
	
	[Column("software_id")]
	public Guid? SoftwareId { get; set; }
	/// <summary>
	/// SoftwareEntity which can be corrupted by this CVE
	/// </summary>
	public SoftwareEntity? Software { get; init; }
	[Column("software_version")]
	public string? SoftwareVersion { get; set; }

	[Column("cve_year")]
	public int CveYear { get; set; }
	[Column("cve_cna_number")]
	public string CveCnaNumber { get; set; }
	public CveEntity Cve { get; set; }
	
	public CveSolutionEntity? CveSolution { get; set; }
}